sudo: false

language: python

python: "2.7"

# Cache the pip directory. "cache: pip" doesn't work due to install override. See https://github.com/travis-ci/travis-ci/issues/3239.
cache:
  - directories:
    - $HOME/.cache/pip

before_install:
  - curl -O https://download.elasticsearch.org/elasticsearch/elasticsearch/elasticsearch-0.90.13.zip
  - unzip elasticsearch-0.90.13.zip
  - elasticsearch-0.90.13/bin/elasticsearch


install:
  - "pip install -U pip wheel coveralls"
  - make requirements


script: make validate

after_success: coveralls

deploy:
  provider: pypi
  user: edx
  password:
    secure: cMZzzg6zBrw55qlznVKb/3AaRVI9yeN4HhQOOUrGtcsEvamuOGyOXdYwNamKRqTy3VJIjRKVder+kSnEwNGoFPUBUdNIEN70IxyiGcnhLppoIvCw3FO3RI0J2N08oUSoK0nM+ACvNRT+Q2GQj3awyPJyb6J20QixCYvwax/O3v8=
  distributions: "sdist bdist_wheel"
  on:
    tags: true
